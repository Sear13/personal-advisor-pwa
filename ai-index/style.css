:root{
  --bg:#0b0b1a;          /* deep night blue */
  --panel:#1a1a2e;       /* indigo panel */
  --ink:#e0e0ff;         /* light lavender text */
  --muted:#7f85a3;       /* muted slate */
  --border:#2f2f55;      /* cool border */
  --accent:#4a3cff;      /* glowing indigo for user bubble + buttons */
  --accent-ink:#ffffff;  /* white text */
  --paper:#151530;       /* assistant bubble bg */
  --ring:rgba(102,51,255,.35);

  /* safe-area for mobile */
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0; color:var(--ink);
  background: var(--bg);
  font: 15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial;
  overflow:hidden; /* page itself never scrolls */
}

/* ------- app shell ------- */
.app{
  height:100vh; display:flex; flex-direction:column; position: relative; z-index:1;
}
.app-main{
  flex:1 1 auto; display:flex; flex-direction:column; min-height:0;
  max-width:980px; width:100%; margin:0 auto; padding:16px 18px 18px;
  gap:12px;
}

/* ------- messages panel ------- */
.messages{
  flex:1 1 auto; min-height:0; overflow:auto; padding:18px 18px 20px;
  background:rgba(20,20,40,0.85);
  backdrop-filter: blur(8px);
  border:1px solid var(--border);
  border-radius:16px;
  box-shadow:0 8px 24px rgba(0,0,0,0.5);
}

/* inline header inside messages */
.chat-header{
  flex:0 0 auto;
  padding:12px 16px;
  background:rgba(30,30,60,.55);
  border-bottom:1px solid rgba(255,255,255,0.08);
  border-radius:12px 12px 0 0;
  margin:-18px -18px 12px -18px; /* align header to panel edges */
  box-shadow:inset 0 -1px 0 rgba(255,255,255,.05);
}
.chat-header .title{
  font-weight:800; letter-spacing:.2px;
  color:#b7bfff; text-shadow:0 1px 2px rgba(0,0,0,.6);
}

/* custom scrollbar */
.messages::-webkit-scrollbar{ width:12px; }
.messages::-webkit-scrollbar-thumb{
  background: #4a3cff77; border-radius:12px; border:3px solid transparent;
  background-clip:padding-box;
}
.messages::-webkit-scrollbar-thumb:hover{ background:#6b5cff; }

/* ------- bubbles ------- */
.msg{ margin:10px 0; display:flex; }
.msg .bubble{
  max-width:80%;
  padding:12px 14px;
  border-radius:14px;
  line-height:1.45;
  border:1px solid var(--border);
  transition: transform .08s ease;
}
.msg .bubble:hover{ transform: translateY(-1px); }

/* user */
.msg.user{ justify-content:flex-end; }
.msg.user .bubble{
  background:var(--accent); color:var(--accent-ink);
  border:none;
  border-bottom-right-radius:6px;
  box-shadow:0 0 12px rgba(102,51,255,0.5);
}

/* assistant */
.msg.assistant .bubble{
  background:var(--paper); color:var(--ink);
  border-bottom-left-radius:6px;
  box-shadow:0 0 8px rgba(0,0,0,0.5);
}

/* links */
.msg .bubble a{
  color:#6b5cff; text-decoration:underline; text-underline-offset:2px;
  transition: color .15s ease;
}
.msg .bubble a:hover{ color:#9b8fff; }

/* typing loader */
.msg.assistant.typing .bubble{ display:flex; align-items:center; gap:10px; }
.loader{ display:inline-flex; align-items:center; gap:6px; }
.loader span{
  width:7px; height:7px; border-radius:50%;
  background:#8a82ff; opacity:.6; transform:translateY(0);
  animation: bounce 1.1s infinite ease-in-out;
}
.loader span:nth-child(2){ animation-delay:.15s; }
.loader span:nth-child(3){ animation-delay:.3s; }
@keyframes bounce {
  0%, 80%, 100% { transform: translateY(0); opacity:.6; }
  40% { transform: translateY(-6px); opacity:1; }
}

/* ------- composer ------- */
.composer{
  flex:0 0 auto; display:flex; gap:10px; align-items:flex-end;
  padding-left: var(--safe-left); padding-right: var(--safe-right);
}
.input{
  flex:1; resize:none; max-height:30vh; min-height:44px;
  padding:12px 12px 12px 14px; border-radius:12px;
  border:1px solid var(--border); background:#0f0f25; color:var(--ink);
  outline:none; box-shadow:0 6px 16px rgba(0,0,0,.4);
  transition: border-color .2s ease, box-shadow .2s ease;
}
.input:focus{
  border-color:var(--ring);
  box-shadow:0 0 0 4px rgba(102,51,255,.2), 0 8px 24px rgba(0,0,0,.4);
}

.actions{ display:flex; gap:8px; }
.btn{
  padding:10px 14px; border-radius:12px; border:1px solid var(--border);
  background:linear-gradient(180deg,#25254f,#1a1a3d);
  color:var(--ink); cursor:pointer; font-weight:700;
  box-shadow:0 6px 16px rgba(0,0,0,.4);
  transition: transform .08s ease, background-color .2s ease, color .2s ease, opacity .2s ease;
}
.btn:hover:not(:disabled){ transform:translateY(-1px); }
.btn:active:not(:disabled){ transform:translateY(0); }

.btn.primary{
  background:linear-gradient(180deg,#4a3cff,#3627d1);
  color:var(--accent-ink);
  border:1px solid #6a5cff;
  box-shadow:0 0 12px rgba(102,51,255,.4);
}
.btn.primary:hover:not(:disabled){
  background:linear-gradient(180deg,#6658ff,#4a3cff);
}
.btn:disabled{ opacity:.55; cursor:not-allowed; transform:none; }

/* scroll-to-bottom FAB */
.scroll-down{
  position:absolute; right:26px; bottom:96px;
  width:38px; height:38px; border-radius:999px;
  border:1px solid var(--border); background:linear-gradient(180deg,#25254f,#1a1a3d);
  color:var(--ink); display:none; align-items:center; justify-content:center;
  box-shadow:0 10px 26px rgba(0,0,0,.5);
}
.scroll-down.show{ display:flex; }

/* background rotator */
#bg-rotator{
  position: fixed; inset: 0;
  background-size: cover; background-position: center; background-repeat: no-repeat;
  z-index: 0; opacity: 1;
  transition: opacity 1s ease-in-out, background-image 1s ease-in-out;
}
#bg-rotator::after{
  content:""; position:absolute; inset:0; background: rgba(0,0,0,.35);
}

/* ===== Advisor (floating, left side) ===== */
@keyframes advisorBob{ 0%,100%{ transform: translateY(0);} 50%{ transform: translateY(-4px);} }

.advisor-overlay{
  position: fixed;
  top: calc(var(--safe-top) + 20px);
  left: calc(var(--safe-left) + 16px); /* left side */
  display:flex; align-items:center; gap:12px;
  z-index:999; pointer-events:none;
  transition: opacity .25s ease, transform .25s ease;
}
.advisor-overlay.hidden{ opacity:0; transform: translateY(-6px); }

.advisor-cloud{
  background: linear-gradient(180deg,#4a3cff,#3627d1);
  border-radius: 50%; padding:10px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.45);
}
.advisor-img{
  width:64px; height:64px; border-radius:50%;
  display:block; border:2px solid var(--border);
  background:#0f0f25; animation: advisorBob 3.5s ease-in-out infinite;
}
.advisor-speech{
  max-width: min(52ch, 40vw);
  padding: 12px 14px;
  font-size: 14px; line-height: 1.4; color: var(--ink);
  background: rgba(26,26,46,.92); border: 1px solid var(--border);
  border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,.5);
  opacity: 0; transform: translateY(-4px);
  transition: opacity .18s ease, transform .18s ease;
  position: relative;
}
.advisor-speech::before{
  content:""; position:absolute; left:-10px; top:18px;
  border-right:10px solid rgba(26,26,46,.92);
  border-top:8px solid transparent; border-bottom:8px solid transparent;
  filter: drop-shadow(1px 0 0 var(--border));
}
.advisor-overlay.talking .advisor-speech{ opacity:1; transform:translateY(0); }

/* ========= Responsive tweaks ========= */

/* Tablets (<= 900px) */
@media (max-width: 900px){
  .app-main{ max-width: 760px; padding:14px 14px 16px; }
  .messages{ border-radius:14px; padding:16px; }
  .chat-header{ margin:-16px -16px 10px -16px; }

  .advisor-img{ width:58px; height:58px; }
  .advisor-speech{ max-width: min(60ch, 50vw); }
}

/* Phones (<= 640px) */
@media (max-width: 640px){
  body{ font-size: 14px; }
  .app-main{ max-width: 100%; padding:12px 10px calc(12px + var(--safe-bottom)); }
  .messages{ padding:14px; border-radius:14px; }
  .chat-header{ margin:-14px -14px 10px -14px; }

  .msg .bubble{ max-width:90%; padding:11px 12px; }

  /* Composer stacks on small screens */
  .composer{ flex-direction: column; align-items: stretch; gap:8px; }
  .actions{ justify-content: flex-end; }
  .btn{ padding:10px 14px; }

  /* FAB above home bar */
  .scroll-down{
    right: calc(var(--safe-right) + 12px);
    bottom: calc(var(--safe-bottom) + 84px);
  }

  /* Advisor scales and keeps clear of status/notch */
  .advisor-overlay{
    top: calc(var(--safe-top) + 12px);
    left: calc(var(--safe-left) + 12px);
    gap: 8px;
  }
  .advisor-cloud{ padding:6px; }
  .advisor-img{ width:52px; height:52px; border-width:1px; }
  .advisor-speech{
    max-width: min(70vw, 48ch);
    padding:10px 12px; font-size:13.5px;
  }
  .advisor-speech::before{
    left:-8px; top:16px; border-right-width:8px; border-top-width:7px; border-bottom-width:7px;
  }
}

/* Tiny phones (<= 380px) */
@media (max-width: 380px){
  .advisor-img{ width:46px; height:46px; }
  .advisor-speech{ max-width:72vw; font-size:13px; }
}

@media (display-mode: standalone) {
  body { padding-top: env(safe-area-inset-top); }
}